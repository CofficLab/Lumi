这是一个将 **RClick** 的 Finder 右键菜单功能集成到 Lumi 的方案。由于 Lumi 的插件系统是进程内的，而 Finder 扩展需要独立的 App Extension Target，因此我们将采用 **“伪集成” + 核心服务化** 的策略：

### 1. 架构调整 (Architecture Adjustment)

由于无法通过 Lumi 的 `Plugins` 目录直接“动态”生成 Finder 扩展 Target，我们需要采取以下步骤：

1.  **手动添加 Extension Target**: 在 Xcode 项目中手动添加一个名为 `LumiFinderExtension` 的 **Finder Sync Extension** Target。
2.  **创建 `RClickPlugin`**: 在 Lumi 主工程中创建一个标准的插件，用于配置右键菜单的内容（如“新建文件”、“复制路径”等）。
3.  **建立通信桥梁 (Bridge)**: 使用 **App Groups (`UserDefaults`)** 作为主应用（插件）与 Finder 扩展之间的通信媒介。

### 2. 功能模块 (Modules)

#### A. 主应用插件 (`Plugins/RClickPlugin`)
*   **配置界面**: 提供 UI 让用户选择启用哪些右键菜单项（例如：New File, Copy Path, Open in Terminal）。
*   **数据同步**: 当用户更改配置时，将配置数据（JSON）写入 App Group 的 `UserDefaults`。
*   **核心逻辑**: 封装实际的文件操作逻辑（虽然 Finder 扩展也可以做，但复杂操作建议由主应用处理，这里先让扩展处理简单逻辑）。

#### B. Finder 扩展 (`LumiFinderExtension`)
*   **`FinderSyncController`**: 继承 `FIFinderSync`。
*   **配置读取**: 每次显示菜单前，从 App Group 读取最新的菜单配置。
*   **菜单构建**: 根据配置动态生成 `NSMenu`。
*   **动作执行**: 执行简单的文件操作（如新建文件），或者通过 `NSWorkspace` / URL Scheme 唤起主应用处理复杂任务。

### 3. 实现步骤 (Implementation Steps)

#### Phase 1: 插件基础结构 (In-Process)
1.  创建 `Plugins/RClickPlugin` 目录。
2.  实现 `RClickPlugin.swift` (SuperPlugin)。
3.  创建 `RClickSettingsView`，允许用户勾选需要的功能（如 "Create New File", "Copy Path"）。
4.  实现 `RClickConfigManager`，负责将用户的选择保存到 App Group UserDefaults。

#### Phase 2: Finder Extension Target (Manual Step)
*   **注意**: 这一步通常需要手动操作 Xcode（File -> New Target）。作为 AI，我无法点击 Xcode 菜单。
*   **替代方案**: 我将为您生成 Finder Extension 的**源代码文件** (`FinderSync.swift`)，并指导您如何手动添加 Target 并将代码放入其中。
*   **模拟集成**: 在当前阶段，我将在 `Plugins/RClickPlugin/ExtensionStub` 中存放扩展的代码，供您手动集成。

#### Phase 3: 通信与逻辑实现
1.  定义共享的数据模型 `RClickMenuItem` (Codable)。
2.  在插件中实现配置保存逻辑。
3.  在扩展代码桩中实现读取配置并动态生成 `NSMenu` 的逻辑。

